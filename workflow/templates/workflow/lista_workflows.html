{# workflow/templates/workflow/lista_workflows.html #}
{% extends 'base.html' %}
{% load math_filters %}

{% block title %}Workflows | Sistema Jurídico{% endblock %}

{% block content %}
<div class="workflows-container">
    
    {# Este componente de header já foi estilizado globalmente #}
    <div class="hero-header">
        <div class="hero-content">
            <h1 class="hero-title">
                <div class="hero-icon" style="background: var(--primary);"> {# Mantido o estilo aqui para sobrepor o tema laranja, já que essa página tinha um tema roxo #}
                    <i class="fa-solid fa-diagram-project"></i>
                </div>
                Meus Workflows
            </h1>
            <a href="{% url 'workflow:workflow_builder' %}" class="btn btn-primary">
                <i class="fa-solid fa-plus-circle"></i>
                Novo Workflow
            </a>
        </div>
    </div>
    
    {% if workflows %}
        <div class="workflows-grid">
            {% for workflow in workflows %}
                <div class="workflow-card" style="animation-delay: {{ forloop.counter0|multiply:0.05 }}s;">
                    <div class="workflow-header">
                        <div class="workflow-nome">{{ workflow.nome }}</div>
                        <div class="workflow-meta">
                            {# Usando as classes de badge globais #}
                            <span class="badge bg-dark">
                                <i class="fa-solid fa-layer-group"></i>
                                {{ workflow.fases.count }} fase{{ workflow.fases.count|pluralize }}
                            </span>
                            <span class="badge bg-success">
                                <i class="fa-solid fa-briefcase"></i>
                                {{ workflow.casos_count }} caso{{ workflow.casos_count|pluralize }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="workflow-details">
                        <div><strong>Cliente:</strong> {{ workflow.cliente.nome }}</div>
                        <div><strong>Produto:</strong> {{ workflow.produto.nome }}</div>
                    </div>
                    
                    <div class="workflow-actions">
                        <a href="{% url 'workflow:workflow_builder_edit' workflow.id %}" class="btn action-btn btn-edit">
                            <i class="fa-solid fa-pen"></i> Editar
                        </a>
                        <a href="{% url 'workflow:duplicar_workflow' workflow.id %}" class="btn action-btn btn-info">
                            <i class="fa-solid fa-copy"></i> Duplicar
                        </a>
                        <form method="post" action="{% url 'workflow:deletar_workflow' workflow.id %}" onsubmit="return confirm('⚠️ Tem certeza? Esta ação não pode ser desfeita!');">
                            {% csrf_token %}
                            <button type="submit" class="btn action-btn btn-delete">
                                <i class="fa-solid fa-trash"></i> Deletar
                            </button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        {# Usando o componente .empty-state global #}
        <div class="empty-state">
            <i class="fa-solid fa-diagram-project"></i>
            <h3>Nenhum workflow criado</h3>
            <p>Comece criando seu primeiro workflow!</p>
            <a href="{% url 'workflow:workflow_builder' %}" class="btn btn-primary mt-4">
                <i class="fa-solid fa-plus-circle"></i>
                Criar Primeiro Workflow
            </a>
        </div>
    {% endif %}
    
</div>
{% endblock %}