<!-- workflow/templates/workflow/kanban.html -->
{% extends 'base.html' %}
{% load file_icons %} {# Carrega o filtro 'get_item' #}

{% block title %}Visão Kanban do Workflow{% endblock %}

{% block extra_css %}
<style>

    
    .kanban-board {
        display: flex;
        gap: 20px;
        overflow-x: auto; /* Permite rolagem horizontal se não couber */
        padding-bottom: 20px;
    }
    .kanban-column {
        flex: 0 0 320px; /* Largura fixa para cada coluna */
        background-color: #e2e8f0; /* Cinza claro de fundo */
        border-radius: 12px;
    }
    .column-header {
        padding: 15px;
        font-weight: 600;
        color: var(--text-dark);
        border-bottom: 1px solid #cbd5e1;
        display: flex;
        justify-content: space-between;
    }
    .case-count {
        background-color: #cbd5e1;
        color: var(--text-dark);
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
    }
    .column-body {
        padding: 15px;
        min-height: 70vh; /* Altura mínima para a área de arrastar */
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .kanban-card {
        background-color: var(--bg-card);
        border-radius: 8px;
        padding: 15px;
        border: 1px solid var(--border-color);
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        cursor: grab; /* Indica que pode ser arrastado */
    }
    .card-title {
        font-weight: 600;
        color: var(--primary-color);
        margin: 0 0 8px;
    }
    .card-details {
        font-size: 0.85em;
        color: var(--text-medium);
    }
    .card-description {
    font-size: 0.9em;
    color: var(--text-dark);
    margin: 8px 0;
    /* Lógica para limitar a 2 linhas */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    min-height: 2.7em;
    }
    .card-details p { margin: 4px 0; }
</style>
{% endblock %}

{% block content %}
    <h1 style="font-size: 2.25rem; font-weight: 700; margin-bottom: 24px;">Visão dos Casos por Fase do Workflow</h1>

    <div class="kanban-board">
        {% for fase in fases %}
            <div class="kanban-column">
                <div class="column-header">
                    <span>{{ fase.nome }}</span>
                    <span class="case-count">{{ casos_por_fase|get_item:fase.id|length }}</span>
                </div>
                <div class="column-body">
                    {% for caso in casos_por_fase|get_item:fase.id %}
                        <a href="{% url 'casos:detalhe_caso' pk=caso.pk %}" style="text-decoration: none;">
                            <div class="kanban-card">
                                <h4 class="card-title">#{{ caso.id|stringformat:"05d" }}</h4>
                                <div class="card-details">
                                    <p class="card-description">{{ caso.titulo|default:"(Sem título)"|truncatechars:50 }}</p>
                                    <p><strong>Cliente:</strong> {{ caso.cliente.nome }}</p>
                                    <p><strong>Responsável:</strong> {% if caso.advogado_responsavel %}{{ caso.advogado_responsavel.username }}{% else %}-{% endif %}</p>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}