{% extends "base.html" %}
{% load static %}

{% block title %}Painel de Ações | Sistema Jurídico{% endblock %}

{% block content %}
<div class="lista-acoes-container">
    
    <!-- HERO HEADER -->
    <div class="hero-header">
        <div class="hero-content">
            <div>
                <h1 class="hero-title">
                    <i class="fa-solid fa-tasks"></i>
                    Painel de Ações
                </h1>
                <p class="hero-subtitle text-muted">
                    Gerencie todas as ações do sistema em um só lugar
                </p>
            </div>
        </div>
    </div>
    
    <!-- CARDS DE ESTATÍSTICAS -->
    <div class="stats-grid">
        <div class="stat-card pendente">
            <div class="stat-header"><div class="stat-icon"><i class="fa-solid fa-clock"></i></div></div>
            <div class="stat-value" id="stat-pendente">-</div>
            <div class="stat-label">Pendentes</div>
        </div>
        
        <div class="stat-card em-andamento">
            <div class="stat-header"><div class="stat-icon"><i class="fa-solid fa-spinner"></i></div></div>
            <div class="stat-value" id="stat-em-andamento">-</div>
            <div class="stat-label">Em Andamento</div>
        </div>
        
        <div class="stat-card concluida">
            <div class="stat-header"><div class="stat-icon"><i class="fa-solid fa-check-circle"></i></div></div>
            <div class="stat-value" id="stat-concluida">-</div>
            <div class="stat-label">Concluídas</div>
        </div>
        
        <div class="stat-card atrasada">
            <div class="stat-header"><div class="stat-icon"><i class="fa-solid fa-exclamation-triangle"></i></div></div>
            <div class="stat-value" id="stat-atrasada">-</div>
            <div class="stat-label">Atrasadas</div>
        </div>
    </div>
    
    <!-- FILTROS -->
    <div class="filtros-card">
        <div class="filtros-header">
            <i class="fa-solid fa-filter"></i>
            <h2 class="filtros-title">Filtros de Pesquisa</h2>
        </div>
        
        <form method="GET" action="{% url 'workflow:lista_todas_acoes' %}">
            <div class="form-row">
                <div class="form-group">
                    <label for="id_filtro_responsavel"><i class="fa-solid fa-user"></i> Responsável</label>
                    <select class="form-control" id="id_filtro_responsavel" name="filtro_responsavel">
                        <option value="">Todos os Responsáveis</option>
                        {% for resp in todos_responsaveis %}
                            <option value="{{ resp.id }}" {% if valores_filtro.filtro_responsavel == resp.id|stringformat:"s" %}selected{% endif %}>
                                {{ resp.get_full_name|default:resp.username }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="id_filtro_status"><i class="fa-solid fa-flag"></i> Status</label>
                    <select class="form-control" id="id_filtro_status" name="filtro_status">
                        <option value="">Todos os Status</option>
                        {% for value, display in status_choices %}
                            <option value="{{ value }}" {% if valores_filtro.filtro_status == value %}selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="id_prazo_de"><i class="fa-solid fa-calendar-day"></i> Prazo (de)</label>
                    <input type="date" class="form-control" id="id_prazo_de" name="filtro_prazo_de" value="{{ valores_filtro.filtro_prazo_de }}">
                </div>
                
                <div class="form-group">
                    <label for="id_prazo_ate"><i class="fa-solid fa-calendar-check"></i> Prazo (até)</label>
                    <input type="date" class="form-control" id="id_prazo_ate" name="filtro_prazo_ate" value="{{ valores_filtro.filtro_prazo_ate }}">
                </div>
            </div>
            
            <div class="filtros-actions">
                <button type="submit" class="btn btn-filter"><i class="fa-solid fa-magnifying-glass"></i> Filtrar Ações</button>
                <a href="{% url 'workflow:lista_todas_acoes' %}" class="btn btn-clear"><i class="fa-solid fa-eraser"></i> Limpar Filtros</a>
            </div>
        </form>
    </div>
    
    <!-- TABELA -->
    <div class="table-card">
        <div class="table-header">
            <h2 class="table-title"><i class="fa-solid fa-list-check"></i> Lista de Ações</h2>
        </div>
        
        <div class="table-responsive">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th><i class="fa-solid fa-folder"></i> Caso</th>
                        <th><i class="fa-solid fa-tasks"></i> Ação</th>
                        <th><i class="fa-solid fa-flag"></i> Status</th>
                        <th><i class="fa-solid fa-user"></i> Responsável</th>
                        <th><i class="fa-solid fa-calendar"></i> Prazo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for acao_inst in acoes %}
                    <tr onclick="window.location='{% url 'casos:detalhe_caso' pk=acao_inst.caso.pk %}?aba=acoes'">
                        <td>
                            <a href="{% url 'casos:detalhe_caso' pk=acao_inst.caso.pk %}?aba=acoes" onclick="event.stopPropagation();">
                                <strong>#{{ acao_inst.caso.id|stringformat:"05d" }}</strong> - {{ acao_inst.caso.titulo|truncatechars:40 }}
                            </a>
                        </td>
                        <td><strong>{{ acao_inst.acao.titulo }}</strong></td>
                        <td>
                            <span class="badge 
                                {% if acao_inst.status == 'PENDENTE' %}bg-warning
                                {% elif acao_inst.status == 'EM_ANDAMENTO' %}bg-info
                                {% elif acao_inst.status == 'CONCLUIDA' %}bg-success
                                {% elif acao_inst.status == 'ATRASADA' %}bg-danger
                                {% else %}bg-secondary{% endif %}">
                                {{ acao_inst.get_status_display }}
                            </span>
                        </td>
                        <td>
                            {% if acao_inst.responsavel %}
                                <i class="fa-solid fa-user-circle"></i> {{ acao_inst.responsavel.get_full_name|default:acao_inst.responsavel.username }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if acao_inst.data_prazo %}
                                <span class="prazo-indicator" data-prazo="{{ acao_inst.data_prazo|date:'Y-m-d' }}">{{ acao_inst.data_prazo|date:"d/m/Y" }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5">
                            <div class="empty-state">
                                <i class="fa-solid fa-inbox"></i>
                                <h3>Nenhuma ação encontrada</h3>
                                <p>Tente ajustar os filtros ou verifique se há ações cadastradas.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/painel_acoes.js' %}"></script>
{% endblock %}