{% extends "base.html" %}
{% load static %}

{% block title %}Recuperar Senha | Sistema Jurídico{% endblock %}

{% block content %}
<!-- Wrapper para centralizar e dar o fundo laranja -->
<div class="reset-wrapper">
    
    <!-- Elementos Decorativos -->
    <div class="reset-bg-circle rbc-1"></div>
    <div class="reset-bg-circle rbc-2"></div>

    <div class="reset-container">
        <div class="reset-card">
            
            <!-- Ícone Envelope -->
            <div class="reset-icon-box">
                <div class="reset-icon-anim">
                    <i class="fa-solid fa-envelope"></i>
                </div>
            </div>

            <!-- Cabeçalho -->
            <div class="reset-header">
                <h1>Esqueceu sua Senha?</h1>
                <p>Não se preocupe! Digite seu e-mail abaixo e enviaremos as instruções para redefinir.</p>
            </div>

            <!-- Info Box -->
            <div class="reset-info-box">
                <i class="fa-solid fa-circle-info reset-info-icon"></i>
                <div class="reset-info-text">
                    <strong>Como funciona:</strong> Você receberá um link seguro válido por 24 horas para criar uma nova senha.
                </div>
            </div>

            <!-- Formulário -->
            <form method="post" id="resetForm">
                {% csrf_token %}
                
                <div class="login-form-group">
                    <label for="id_email" class="login-label">
                        E-mail Cadastrado
                    </label>
                    <div class="login-input-wrapper">
                        <input type="email" id="id_email" name="email" class="login-input" 
                            placeholder="seu@email.com" required autofocus>
                        <i class="fa-solid fa-at login-input-icon"></i>
                    </div>
                    
                    {% if form.email.errors %}
                        <div class="login-error-msg" style="margin-top: 10px;">
                            <i class="fa-solid fa-circle-exclamation"></i>
                            <span>{{ form.email.errors.0 }}</span>
                        </div>
                    {% endif %}
                </div>

                <button type="submit" class="btn-reset-submit" id="submitBtn">
                    <i class="fa-solid fa-paper-plane"></i>
                    <span>Enviar Instruções</span>
                </button>
            </form>

            <!-- Footer -->
            <div class="reset-footer">
                <p style="color:#6b7280; margin-bottom:10px;">Lembrou sua senha?</p>
                <a href="{% url 'login' %}">
                    <i class="fa-solid fa-arrow-left"></i>
                    Voltar para o Login
                </a>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // 1. Validação Visual do Email
    const emailInput = document.getElementById('id_email');
    if (emailInput) {
        emailInput.addEventListener('input', function() {
            const email = this.value;
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            // Reutilizando estilos do login (borda laranja no focus é padrão, aqui usamos cores de validação)
            if (email.length > 0) {
                if (regex.test(email)) {
                    this.style.borderColor = '#22c55e'; // Verde
                    this.style.backgroundColor = '#f0fdf4';
                } else {
                    this.style.borderColor = '#ef4444'; // Vermelho
                    this.style.backgroundColor = '#fef2f2';
                }
            } else {
                this.style.borderColor = ''; // Reset
                this.style.backgroundColor = '';
            }
        });

        // Foco automático
        setTimeout(() => emailInput.focus(), 500);
    }

    // 2. Loading State
    document.getElementById('resetForm').addEventListener('submit', function(e) {
        const btn = document.getElementById('submitBtn');
        const icon = btn.querySelector('i');
        const span = btn.querySelector('span');

        // Impede envio múltiplo
        if (btn.disabled) { e.preventDefault(); return; }

        btn.style.opacity = '0.8';
        btn.style.cursor = 'wait';
        icon.className = 'fa-solid fa-circle-notch fa-spin';
        span.textContent = 'Enviando...';
    });

    // 3. Efeito 3D (Desktop)
    if (window.innerWidth > 768) {
        const card = document.querySelector('.reset-card');
        if(card) {
            document.addEventListener('mousemove', (e) => {
                const x = (window.innerWidth / 2 - e.pageX) / 50;
                const y = (window.innerHeight / 2 - e.pageY) / 50;
                card.style.transform = `perspective(1000px) rotateY(${x}deg) rotateX(${y}deg)`;
            });
            document.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateY(0deg) rotateX(0deg)';
                card.style.transition = 'transform 0.5s ease';
            });
            document.addEventListener('mouseenter', () => {
                card.style.transition = 'none';
            });
        }
    }
});
</script>
{% endblock %}