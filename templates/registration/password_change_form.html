{% extends "base.html" %}
{% load custom_tags %}
{% load static %}

{% block title %}Mudar Senha{% endblock %}

{% block content %}
<div class="card" style="padding: 32px;">
    <h3 class="section-title">Alterar Senha</h3>

    <form method="post" id="change-password-form">
        {% csrf_token %}

        {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
        {% endif %}

        <div class="form-row">
            {% with field=form.old_password class=field|input_class %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field|add_class:class }}
                    {% for error in field.errors %}
                        <div class="invalid-feedback d-block">{{ error }}</div>
                    {% endfor %}
                </div>
            {% endwith %}
        </div>

        <div class="form-row">
            {% with field=form.new_password1 class=field|input_class %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field|add_class:class }}
                    {% for error in field.errors %}
                        <div class="invalid-feedback d-block">{{ error }}</div>
                    {% endfor %}
                    {% if field.help_text %}
                        <div class="form-text text-muted small mt-2">
                            {{ field.help_text|safe }}
                        </div>
                    {% endif %}
                </div>
            {% endwith %}

            {% with field=form.new_password2 class=field|input_class %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field|add_class:class }}
                    {% for error in field.errors %}
                        <div class="invalid-feedback d-block">{{ error }}</div>
                    {% endfor %}
                    {% if field.help_text %}
                        <small class="form-text text-muted d-block mt-2">{{ field.help_text|safe }}</small>
                    {% endif %}
                </div>
            {% endwith %}
        </div>

        <div class="d-flex justify-content-start mt-4 pt-3 border-top">
            <button type="submit" class="btn btn-primary btn-lg me-2" id="submit-btn">
                <i class="fas fa-save me-1"></i> Salvar
            </button>
            <button type="reset" class="btn btn-light btn-lg border">
                <i class="fas fa-eraser me-1"></i> Limpar
            </button>
        </div>
    </form>
</div>

<script>
    document.getElementById("change-password-form").addEventListener("submit", function(e) {
        const btn = document.getElementById("submit-btn");
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span> Salvando...';
    });
</script>
{% endblock %}