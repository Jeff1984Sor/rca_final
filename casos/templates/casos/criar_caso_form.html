{% extends 'base.html' %}

{% block title %}
    {% if caso %}
        Editando Caso #{{ caso.id|stringformat:"05d" }}
    {% else %}
        Novo Caso - Formulário
    {% endif %}
{% endblock %}

{% block content %}
    <!-- A div que centralizava e limitava a largura foi REMOVIDA -->
    
    {% if caso %}
        <h1 style="font-size: 2.25rem; font-weight: 700; margin-bottom: 24px;">Editando Caso #{{ caso.id|stringformat:"05d" }}</h1>
    {% else %}
        <h1 style="font-size: 2.25rem; font-weight: 700; margin-bottom: 24px;">Abrir Novo Caso</h1>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        
        <!-- Card 1: DADOS PRINCIPAIS -->
        <div class="card" style="padding: 32px;">
            <h3 class="section-title">Dados Principais do Caso</h3>
            
            {% if caso and produto.padrao_titulo %}
            <div class="form-group">
                <label>Título do Caso (gerado automaticamente)</label>
                <div style="background-color: var(--bg-subtle); padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); font-weight: 500;">{{ caso.titulo }}</div>
            </div>
            {% endif %}

            <div class="form-row">
                <div class="form-group">
                    <label>Cliente</label>
                    <input type="text" value="{{ cliente.nome }}" disabled>
                </div>
                <div class="form-group">
                    <label>Produto</label>
                    <input type="text" value="{{ produto.nome }}" disabled>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">{{ form.status.label_tag }}{{ form.status }}</div>
                <div class="form-group">{{ form.data_entrada.label_tag }}{{ form.data_entrada }}</div>
                <div class="form-group">{{ form.data_encerramento.label_tag }}{{ form.data_encerramento }}</div>
            </div>
            
            <div class="form-group">{{ form.advogado_responsavel.label_tag }}{{ form.advogado_responsavel }}</div>
            
            {% if form.titulo_manual %}
                <div class="form-group">{{ form.titulo_manual.label_tag }}{{ form.titulo_manual }}</div>
            {% endif %}
        </div>

        <!-- Card 2: DADOS ADICIONAIS -->
        <div class="card" style="padding: 32px; margin-top: 24px;">
            <h3 class="section-title">Dados Adicionais</h3>
            
            {% for field in form %}
                {% if field.name|slice:":19" == 'campo_personalizado' %}
                    <div class="form-group">{{ field.label_tag }}{{ field }}</div>
                {% endif %}
            {% endfor %}

            
        </div>
        
        <!-- BOTÕES DE AÇÃO -->
        <div style="margin-top: 30px; display: flex; justify-content: flex-end; gap: 10px;">
            <a href="{% if caso %}{% url 'casos:detalhe_caso' pk=caso.pk %}{% else %}{% url 'casos:lista_casos' %}{% endif %}" class="btn btn-secondary">Cancelar</a>
            <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
    </form>
{% endblock %}