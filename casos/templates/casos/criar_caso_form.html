{% extends 'base.html' %}

{% block title %}
    {% if caso %}
        Editando Caso #{{ caso.id|stringformat:"05d" }}
    {% else %}
        Novo Caso - Formulário
    {% endif %}
{% endblock %}

{% block content %}
    
    {% if caso %}
        <h1 style="font-size: 2.25rem; font-weight: 700; margin-bottom: 24px;">Editando Caso #{{ caso.id|stringformat:"05d" }}</h1>
    {% else %}
        <h1 style="font-size: 2.25rem; font-weight: 700; margin-bottom: 24px;">Abrir Novo Caso</h1>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        
        <!-- Card 1: DADOS PRINCIPAIS -->
        <!-- Card 1: DADOS PRINCIPAIS (VERSÃO CORRIGIDA) -->
        <div class="card" style="padding: 32px;">
            <h3 class="section-title">Dados Principais do Caso</h3>

            <div class="form-row">
                <div class="form-group">
                    <label>Cliente</label>
                    <input type="text" value="{{ cliente.nome }}" disabled>
                </div>
                <div class="form-group">
                    <label>Produto</label>
                    <input type="text" value="{{ produto.nome }}" disabled>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="{{ form.status.id_for_label }}">{{ form.status.label }}</label>
                    {{ form.status }}
                </div>
                <div class="form-group">
                    <label for="{{ form.data_entrada.id_for_label }}">{{ form.data_entrada.label }}</label>
                    {{ form.data_entrada }}
                </div>
                <div class="form-group">
                    <label for="{{ form.data_encerramento.id_for_label }}">{{ form.data_encerramento.label }}</label>
                    {{ form.data_encerramento }}
                </div>
            </div>
            
            <div class="form-group">
                <label for="{{ form.advogado_responsavel.id_for_label }}">{{ form.advogado_responsavel.label }}</label>
                {{ form.advogado_responsavel }}
            </div>
            
            {% if form.titulo_manual %}
                <div class="form-group">
                    <label for="{{ form.titulo_manual.id_for_label }}">{{ form.titulo_manual.label }}</label>
                    {{ form.titulo_manual }}
                </div>
            {% endif %}
        </div>

        <!-- Card 2: DADOS ADICIONAIS -->
        <div class="card" style="padding: 32px; margin-top: 24px;">
            <h3 class="section-title">Dados Adicionais</h3>
            
            <!-- ============================================================================== -->
            <!-- A MÁGICA DA GRADE DE 3 COLUNAS ACONTECE AQUI                                   -->
            <!-- ============================================================================== -->
            <div class="form-grid-3-cols">
                {% for field in form %}
                    {# Itera por TODOS os campos do formulário #}
                    {% if field.name|slice:":19" == 'campo_personalizado' %}
                        {# E mostra apenas os que são personalizados AQUI DENTRO #}
                        <div class="form-group">
                            {{ field.label_tag }}
                            {{ field }}
                            {% for error in field.errors %}
                                <div class="error-message">{{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <!-- ============================================================================== -->
        </div>
        
        <!-- BOTÕES DE AÇÃO -->
        <div style="margin-top: 30px; display: flex; justify-content: flex-end; gap: 10px;">
            <a href="{% if caso %}{% url 'casos:detalhe_caso' pk=caso.pk %}{% else %}{% url 'casos:lista_casos' %}{% endif %}" class="btn btn-secondary">Cancelar</a>
            <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
    </form>
{% endblock %}

{% block extra_css %}
    {# Adicionamos um novo bloco de CSS no final da página #}
    <style>
        .form-grid-3-cols {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Cria 3 colunas de tamanho igual */
            gap: 20px; /* Espaçamento entre os campos */
        }

        /* Para telas menores (como celulares), fazemos os campos ocuparem a tela inteira */
        @media (max-width: 768px) {
            .form-grid-3-cols {
                grid-template-columns: 1fr; /* Volta para 1 coluna */
            }
        }
    </style>
{% endblock %}