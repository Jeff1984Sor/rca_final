{% extends "base.html" %}
{% load static custom_tags currency_tags file_icons %}

{% block title %}Caso #{{ caso.id }} | {{ caso.titulo }}{% endblock %}

{% block content %}

    <!-- 虫 HERO HEADER -->
    <div class="hero-header">
        <div class="hero-content">
            <div class="hero-left">
                <div class="case-badge"><i class="fa-solid fa-folder-open"></i> Caso #{{ caso.id }}</div>
                <h1 class="hero-title">{{ caso.titulo|default:"Caso sem tﾃｭtulo" }}</h1>
                <div class="hero-meta">
                    <div class="meta-item"><i class="fa-solid fa-building"></i> <strong>{{ caso.cliente.nome }}</strong></div>
                    <div class="meta-item"><i class="fa-solid fa-box"></i> <strong>{{ caso.produto.nome }}</strong></div>
                    <div class="meta-item"><i class="fa-solid fa-calendar"></i> {{ caso.data_entrada|date:"d/m/Y" }}</div>
                    <div class="meta-item"><span class="badge bg-success">{{ caso.get_status_display }}</span></div>
                </div>
            </div>
            <div>
                {% if caso.prazo_final_calculado %}
                <div class="hero-prazo-card">
                    <div class="prazo-label"><i class="fa-solid fa-clock"></i> Prazo Final</div>
                    <div class="prazo-value">{{ caso.prazo_final_calculado|date:"d/m" }}</div>
                    <div class="prazo-status">{{ caso.prazo_final_calculado|date:"Y" }}</div>
                    <a href="{% url 'casos:editar_caso' pk=caso.pk %}" class="btn btn-sm btn-light mt-3"><i class="fa-solid fa-pen-to-square"></i> Editar Caso</a>
                </div>
                {% else %}<a href="{% url 'casos:editar_caso' pk=caso.pk %}" class="btn btn-primary"><i class="fa-solid fa-pen-to-square"></i> Editar Caso</a>{% endif %}
            </div>
        </div>
    </div>

    <!-- 識 NAVEGAﾃﾃグ TABS -->
    <div class="tabs-container">
        <button class="tab-btn" data-tab="detalhes"><i class="fa-solid fa-circle-info"></i> Detalhes</button>
        <button class="tab-btn" data-tab="acoes"><i class="fa-solid fa-list-check"></i> Aﾃｧﾃｵes</button>
        <button class="tab-btn" data-tab="workflow"><i class="fa-solid fa-diagram-project"></i> Workflow</button>
        <button class="tab-btn" data-tab="fluxo-interno"><i class="fa-solid fa-timeline"></i> Fluxo</button>
        <button class="tab-btn" data-tab="andamentos"><i class="fa-solid fa-file-lines"></i> Andamentos</button>
        <button class="tab-btn" data-tab="timesheet"><i class="fa-solid fa-clock"></i> Timesheet</button>
        <button class="tab-btn" data-tab="acordos"><i class="fa-solid fa-handshake"></i> Acordos</button>
        <button class="tab-btn" data-tab="despesas"><i class="fa-solid fa-dollar-sign"></i> Despesas</button>
        <button class="tab-btn" data-tab="anexos" hx-get="{% url 'casos:carregar_painel_anexos' pk=caso.pk %}" hx-target="#anexos-content" hx-swap="innerHTML" hx-trigger="click once"><i class="fa-solid fa-paperclip"></i> Anexos</button>
        <button class="tab-btn" data-tab="analyser" hx-get="{% url 'casos:carregar_painel_analyser' pk=caso.pk %}" hx-target="#analyser-content" hx-swap="innerHTML" hx-trigger="click once"><i class="fa-solid fa-robot"></i> Analyser IA</button>
    </div>

    <!-- 搭 ABA: DETALHES -->
    <div id="detalhes" class="tab-content">
        <div class="card" id="card-info-basicas">
            <div class="card-header-with-edit">
                <h2 class="card-title-icon card-title"><i class="fa-solid fa-circle-info"></i> Informaﾃｧﾃｵes do Caso</h2>
                <button type="button" class="btn btn-sm action-btn btn-edit" onclick="openEditModal('info-basicas')"><i class="fa-solid fa-pen"></i> Editar</button>
            </div>
            <div class="card-body">
                <div class="details-grid">
                    <div class="detail-card"><div class="detail-label"><i class="fa-solid fa-flag"></i> Status</div><div class="detail-value">{{ caso.get_status_display }}</div></div>
                    <div class="detail-card"><div class="detail-label"><i class="fa-solid fa-calendar-days"></i> Data Entrada</div><div class="detail-value">{{ caso.data_entrada|date:"d/m/Y" }}</div></div>
                    {% if caso.valor_apurado %}<div class="detail-card"><div class="detail-label"><i class="fa-solid fa-money-bill-wave"></i> Valor Apurado</div><div class="detail-value">{{ caso.valor_apurado|currency }}</div></div>{% endif %}
                    <div class="detail-card"><div class="detail-label"><i class="fa-solid fa-route"></i> Fase Atual</div><div class="detail-value">{{ caso.fase_atual_wf.nome|default:"Nﾃ｣o iniciado" }}</div></div>
                    <div class="detail-card"><div class="detail-label"><i class="fa-solid fa-user-tie"></i> Responsﾃ｡vel</div><div class="detail-value">{% if caso.advogado_responsavel %}{{ caso.advogado_responsavel.get_full_name|default:caso.advogado_responsavel.username }}{% else %}Nﾃ｣o atribuﾃｭdo{% endif %}</div></div>
                </div>
            </div>
        </div>
        {% if valores_personalizados %}
        <div class="card mt-4" id="card-dados-adicionais">
            <div class="card-header-with-edit"><h2 class="card-title-icon card-title"><i class="fa-solid fa-sliders"></i> Dados Adicionais</h2><button type="button" class="btn btn-sm action-btn btn-edit" onclick="openEditModal('dados-adicionais')"><i class="fa-solid fa-pen"></i> Editar</button></div>
            <div class="card-body"><div class="details-grid">{% for valor in valores_personalizados %}{% if not valor.instancia_grupo %}<div class="detail-card"><div class="detail-label"><i class="fa-solid fa-tag"></i> {{ valor.campo.nome_campo }}</div><div class="detail-value">{% if valor.campo.tipo_campo == 'BOOLEANO' %}{% if valor.valor == 'True' or valor.valor == '1' or valor.valor == 'true' %}<span class="bool-true"><i class="fa-solid fa-check-circle"></i> Sim</span>{% else %}<span class="bool-false"><i class="fa-solid fa-times-circle"></i> Nﾃ｣o</span>{% endif %}{% else %}{{ valor.valor|format_dynamic_value:valor.campo.tipo_campo|default:"-" }}{% endif %}</div></div>{% endif %}{% endfor %}</div></div>
        </div>
        {% endif %}
        {% if grupos_de_valores_salvos %}{% for instancia in grupos_de_valores_salvos %}<div class="card mt-4"><div class="card-header-with-edit"><h2 class="card-title-icon card-title"><i class="fa-solid fa-layer-group"></i> {{ instancia.grupo.nome_grupo }} #{{ forloop.counter }}</h2><a href="{% url 'casos:editar_caso' pk=caso.pk %}" class="btn btn-sm action-btn btn-edit"><i class="fa-solid fa-pen"></i> Editar</a></div><div class="card-body"><div class="details-grid">{% for valor in instancia.valores.all %}<div class="detail-card"><div class="detail-label"><i class="fa-solid fa-circle-dot"></i> {{ valor.campo.nome_campo }}</div><div class="detail-value">{{ valor.valor|format_dynamic_value:valor.campo.tipo_campo|default:"-" }}</div></div>{% endfor %}</div></div></div>{% endfor %}{% endif %}
    </div>

    <!-- ABA: Aﾃﾃ髭S -->
    <div id="acoes" class="tab-content"><div class="card"><div id="painel-acoes">{% include 'workflow/partials/painel_acoes.html' %}</div></div></div>

    <!-- ABA: WORKFLOW -->
    <div id="workflow" class="tab-content"><div class="card"><h2 class="card-title"><i class="fa-solid fa-diagram-project"></i> Timeline do Workflow</h2><div class="timeline">{% for h in historico_fases %}<div class="timeline-item {% if not h.data_saida %}active{% endif %}"><div class="timeline-icon"><i class="fa-solid fa-{% if not h.data_saida %}spinner fa-spin{% else %}check{% endif %}"></i></div><div class="timeline-content"><h3 class="timeline-title">{{ h.fase.nome }}</h3><div class="timeline-meta"><span><i class="fa-solid fa-arrow-right-to-bracket"></i> Entrada: {{ h.data_entrada|date:"d/m/Y H:i" }}</span>{% if h.data_saida %}<span><i class="fa-solid fa-arrow-right-from-bracket"></i> Saﾃｭda: {{ h.data_saida|date:"d/m/Y H:i" }}</span>{% else %}<span class="badge bg-info">Fase Atual</span>{% endif %}</div></div></div>{% empty %}<div class="empty-state"><i class="fa-solid fa-diagram-project"></i><h3>Workflow nﾃ｣o iniciado</h3></div>{% endfor %}</div></div></div>

    <!-- ABA: FLUXO INTERNO -->
    <div id="fluxo-interno" class="tab-content"><div class="card"><h2 class="card-title"><i class="fa-solid fa-timeline"></i> Linha do Tempo Completa</h2><div class="timeline">{% for evento in fluxo_interno %}<div class="timeline-item"><div class="timeline-icon" style="background: {{ evento.tipo_evento|get_event_color }}; color: white; border: none;">{{ evento.tipo_evento|get_event_icon|safe }}</div><div class="timeline-content"><h3 class="timeline-title">{{ evento.get_tipo_evento_display }}</h3><p style="margin: 12px 0;">{{ evento.descricao|linebreaksbr }}</p><div class="timeline-meta"><span><i class="fa-solid fa-user"></i> {% if evento.autor %}{{ evento.autor.get_full_name|default:evento.autor.username }}{% else %}Sistema{% endif %}</span><span><i class="fa-solid fa-calendar"></i> {{ evento.data_evento|date:"d/m/Y H:i" }}</span></div></div></div>{% empty %}<div class="empty-state"><i class="fa-solid fa-timeline"></i><h3>Nenhum evento registrado</h3></div>{% endfor %}</div></div></div>
    
    <!-- ABA: ANDAMENTOS -->
    <!-- ABA: ANDAMENTOS (CORRIGIDA) -->
    <div id="andamentos" class="tab-content">
        <div class="card">
            <h2 class="card-title"><i class="fa-solid fa-plus-circle"></i> Novo Andamento</h2>
            <form method="POST" action="{% url 'casos:detalhe_caso' pk=caso.pk %}">
                {% csrf_token %}
                {% include "_form_field.html" with field=form_andamento.modelo_andamento %}
                {% include "_form_field.html" with field=form_andamento.data_andamento %}
                {% include "_form_field.html" with field=form_andamento.descricao %}
                <button type="submit" name="submit_andamento" class="btn btn-primary mt-3"><i class="fa-solid fa-save"></i> Salvar</button>
            </form>
        </div>
        
        <div class="card mt-4">
            {# 笨 SEﾃﾃグ ATUALIZADA AQUI 笨 #}
            <div class="card-header-with-edit">
                <h2 class="card-title-icon card-title">
                    <i class="fa-solid fa-file-lines"></i>
                    Histﾃｳrico
                </h2>
                <a href="{% url 'casos:exportar_andamentos_excel' pk=caso.pk %}" class="btn btn-sm btn-export">
                    <i class="fa-solid fa-file-excel"></i>
                    Exportar
                </a>
            </div>
            
            <div class="card-body">
                <div class="timeline">
                    {% for andamento in andamentos %}
                        <div class="timeline-item">
                            <div class="timeline-icon" style="background: var(--warning); color: white; border: none;">
                                <i class="fa-solid fa-pencil"></i>
                            </div>
                            <div class="timeline-content">
                                <h3 class="timeline-title">{{ andamento.data_andamento|date:"d/m/Y" }}</h3>
                                <p style="margin: 12px 0; white-space: pre-wrap;">{{ andamento.descricao }}</p>
                                <div class="timeline-meta">
                                    <span><i class="fa-solid fa-user"></i> {% if andamento.autor %}{{ andamento.autor.get_full_name|default:andamento.autor.username }}{% else %}(removido){% endif %}</span>
                                    <span><i class="fa-solid fa-clock"></i> {{ andamento.data_criacao|date:"d/m/Y H:i" }}</span>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="empty-state">
                            <i class="fa-solid fa-file-lines"></i>
                            <h3>Nenhum andamento</h3>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- ABA: TIMESHEET (CORRIGIDA) -->
    <div id="timesheet" class="tab-content">
        <div class="card">
            <h2 class="card-title"><i class="fa-solid fa-plus-circle"></i> Novo Lanﾃｧamento</h2>
            <form method="POST" action="{% url 'casos:detalhe_caso' pk=caso.pk %}">
                {% csrf_token %}
                <div class="form-row">
                    {% include "_form_field.html" with field=form_timesheet.data_execucao %}
                    {% include "_form_field.html" with field=form_timesheet.tempo %}
                </div>
                {% include "_form_field.html" with field=form_timesheet.advogado classes="full-width" %}
                {% include "_form_field.html" with field=form_timesheet.descricao classes="full-width" %}
                <button type="submit" name="submit_timesheet" class="btn btn-primary mt-3"><i class="fa-solid fa-save"></i> Salvar</button>
            </form>
        </div>
        
        <div class="summary-grid">
            <div class="summary-box animated-gradient">
                <div class="summary-label"><i class="fa-solid fa-clock"></i> Tempo Total Gasto</div>
                <div class="summary-value">{{ tempo_total|format_timedelta }}</div>
            </div>
        </div>
        
        <div class="card mt-4">
            {# 笨 SEﾃﾃグ ATUALIZADA AQUI 笨 #}
            <div class="card-header-with-edit">
                <h2 class="card-title-icon card-title">
                    <i class="fa-solid fa-list"></i>
                    Histﾃｳrico
                </h2>
                <div class="d-flex gap-12">
                    <a href="{% url 'casos:exportar_timesheet_excel' pk=caso.pk %}" class="btn btn-sm btn-export">
                        <i class="fa-solid fa-file-excel"></i> Excel
                    </a>
                    <a href="{% url 'casos:exportar_timesheet_pdf' pk=caso.pk %}" class="btn btn-sm btn-pdf">
                        <i class="fa-solid fa-file-pdf"></i> PDF
                    </a>
                </div>
            </div>

            <div class="card-body">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tempo</th>
                            <th>Advogado</th>
                            <th>Descriﾃｧﾃ｣o</th>
                            <th class="text-right">Aﾃｧﾃｵes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ts in timesheets %}
                        <tr>
                            <td><strong>{{ ts.data_execucao|date:"d/m/Y" }}</strong></td>
                            <td><span class="badge bg-info">{{ ts.tempo }}</span></td>
                            <td>{% if ts.advogado %}{{ ts.advogado.get_full_name|default:ts.advogado.username }}{% else %}-{% endif %}</td>
                            <td style="max-width: 300px;">{{ ts.descricao|truncatewords:10 }}</td>
                            <td class="text-right">
                                <a href="{% url 'casos:editar_timesheet' pk=ts.pk %}" class="btn btn-sm action-btn btn-edit"><i class="fa-solid fa-pen"></i></a>
                                <a href="{% url 'casos:deletar_timesheet' pk=ts.pk %}" class="btn btn-sm action-btn btn-delete"><i class="fa-solid fa-trash"></i></a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5">
                                <div class="empty-state">
                                    <i class="fa-solid fa-clock"></i>
                                    <h3>Nenhum lanﾃｧamento</h3>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- ABA: ACORDOS -->
    <div id="acordos" class="tab-content"><div class="card"><h2 class="card-title"><i class="fa-solid fa-plus-circle"></i> Novo Acordo</h2><form method="POST" action="{% url 'casos:detalhe_caso' pk=caso.pk %}">{% csrf_token %}<div class="form-row">{% include "_form_field.html" with field=form_acordo.valor_total %}{% include "_form_field.html" with field=form_acordo.numero_parcelas %}</div><div class="form-row">{% include "_form_field.html" with field=form_acordo.data_primeira_parcela %}{% include "_form_field.html" with field=form_acordo.advogado_acordo %}</div><button type="submit" name="submit_acordo" class="btn btn-primary mt-3"><i class="fa-solid fa-save"></i> Salvar</button></form></div><div class="summary-grid"><div class="summary-box animated-gradient"><div class="summary-label"><i class="fa-solid fa-money-bill-wave"></i> Saldo Devedor</div><div class="summary-value">{{ saldo_devedor_total|currency|default:"R$ 0,00" }}</div></div></div><div class="card mt-4"><h2 class="card-title"><i class="fa-solid fa-handshake"></i> Acordos Registrados</h2>{% for acordo in acordos %}<div class="card mt-3"><div class="card-header d-flex justify-content-between align-items-center"><div><h3 class="h5">Acordo de {{ acordo.valor_total|currency }} em {{ acordo.numero_parcelas }}x</h3><p class="text-muted small m-0">Criado em {{ acordo.data_criacao|date:"d/m/Y" }} por {% if acordo.advogado_acordo %}{{ acordo.advogado_acordo.get_full_name|default:acordo.advogado_acordo.username }}{% else %}-{% endif %}</p></div><a href="{% url 'casos:editar_acordo' pk=acordo.pk %}" class="btn btn-sm action-btn btn-edit">Editar</a></div><div class="card-body"><table class="data-table"><thead><tr><th>Nﾂｺ</th><th>Vencimento</th><th>Pagamento</th><th>Valor</th><th>Status</th></tr></thead><tbody>{% for p in acordo.parcelas.all %}{% include 'casos/partials/parcela_linha.html' with parcela=p %}{% endfor %}</tbody></table></div></div>{% empty %}<div class="empty-state"><i class="fa-solid fa-handshake"></i><h3>Nenhum acordo</h3></div>{% endfor %}</div></div>
    
    <!-- ABA: DESPESAS -->
    <div id="despesas" class="tab-content"><div class="card"><h2 class="card-title"><i class="fa-solid fa-plus-circle"></i> Nova Despesa</h2><form method="POST" action="{% url 'casos:detalhe_caso' pk=caso.pk %}">{% csrf_token %}<div class="form-row">{% include "_form_field.html" with field=form_despesa.data_despesa %}{% include "_form_field.html" with field=form_despesa.valor %}</div>{% include "_form_field.html" with field=form_despesa.descricao classes="full-width" %}{% include "_form_field.html" with field=form_despesa.advogado classes="full-width" %}<button type="submit" name="submit_despesa" class="btn btn-primary mt-3"><i class="fa-solid fa-save"></i> Salvar</button></form></div><div class="summary-grid"><div class="summary-box animated-gradient"><div class="summary-label"><i class="fa-solid fa-dollar-sign"></i> Total de Despesas</div><div class="summary-value">{{ total_despesas|currency }}</div></div></div><div class="card mt-4"><h2 class="card-title"><i class="fa-solid fa-list"></i> Histﾃｳrico</h2><table class="data-table"><thead><tr><th>Data</th><th>Advogado</th><th>Descriﾃｧﾃ｣o</th><th>Valor</th><th class="text-right">Aﾃｧﾃｵes</th></tr></thead><tbody>{% for d in despesas %}<tr><td><strong>{{ d.data_despesa|date:"d/m/Y" }}</strong></td><td>{% if d.advogado %}{{ d.advogado.get_full_name|default:d.advogado.username }}{% else %}-{% endif %}</td><td>{{ d.descricao }}</td><td><strong>{{ d.valor|currency }}</strong></td><td class="text-right"><a href="{% url 'casos:editar_despesa' pk=d.pk %}" class="btn btn-sm action-btn btn-edit">Editar</a></td></tr>{% empty %}<tr><td colspan="5"><div class="empty-state"><i class="fa-solid fa-dollar-sign"></i><h3>Nenhuma despesa</h3></div></td></tr>{% endfor %}</tbody></table></div></div>
    
    <!-- ABA: ANEXOS (HTMX) -->
    <div id="anexos" class="tab-content">
        <div class="card">
            <div class="card-header-with-edit">
                <h2 class="card-title-icon card-title">
                    <i class="fa-solid fa-paperclip"></i>
                    Anexos do SharePoint
                </h2>
            </div>
            <div class="card-body">
                {# 
                Este container ﾃｩ o alvo da requisiﾃｧﾃ｣o HTMX. 
                Ele comeﾃｧa com um estado de "loading".
                #}
                <div id="anexos-content">
                    <div class="empty-state">
                        <div class="spinner"></div> {# Usando a classe de spinner global #}
                        <p class="text-muted mt-3">Carregando anexos...</p>
                        <small>Isso pode levar alguns segundos na primeira vez.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ABA: ANALYSER (HTMX) -->
    <div id="analyser" class="tab-content"><div id="analyser-content"><div class="card"><div class="empty-state"><i class="fa-solid fa-spinner fa-spin"></i><p>Clique na aba "Analyser IA" para carregar.</p></div></div></div></div>

    <!-- ========================================
         MODAIS DE EDIﾃﾃグ (CORRIGIDOS)
         ======================================== -->
    <div id="modal-info-basicas" class="edit-modal-overlay" onclick="closeModalOnOverlay(event, 'info-basicas')">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <div class="edit-modal-header">
                <h2 class="edit-modal-title"><i class="fa-solid fa-pen"></i> Editar Informaﾃｧﾃｵes do Caso</h2>
                <button type="button" class="btn-close" onclick="closeEditModal('info-basicas')"><i class="fa-solid fa-times"></i></button>
            </div>
            <form class="edit-modal-form" method="POST" action="{% url 'casos:detalhe_caso' pk=caso.pk %}">
                {% csrf_token %}
                <input type="hidden" name="edit_modal" value="info-basicas">
                <div class="form-row">
                    {% include "_form_field.html" with field=form_info_basicas.status %}
                    {% include "_form_field.html" with field=form_info_basicas.data_entrada %}
                    {% include "_form_field.html" with field=form_info_basicas.valor_apurado %}
                    {% include "_form_field.html" with field=form_info_basicas.advogado_responsavel %}
                </div>
                <div class="edit-modal-footer">
                    <button type="button" class="btn btn-outline-secondary" onclick="closeEditModal('info-basicas')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar Alteraﾃｧﾃｵes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-dados-adicionais" class="edit-modal-overlay" onclick="closeModalOnOverlay(event, 'dados-adicionais')">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <div class="edit-modal-header">
                <h2 class="edit-modal-title"><i class="fa-solid fa-pen"></i> Editar Dados Adicionais</h2>
                <button type="button" class="btn-close" onclick="closeEditModal('dados-adicionais')"><i class="fa-solid fa-times"></i></button>
            </div>
            <form class="edit-modal-form" method="POST" action="{% url 'casos:detalhe_caso' pk=caso.pk %}">
                {% csrf_token %}
                <input type="hidden" name="edit_modal" value="dados-adicionais">
                <div class="form-row">
                    {% for field in form_dados_adicionais %}
                        {% include "_form_field.html" with field=field %}
                    {% endfor %}
                </div>
                <div class="edit-modal-footer">
                    <button type="button" class="btn btn-outline-secondary" onclick="closeEditModal('dados-adicionais')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar Alteraﾃｧﾃｵes</button>
                </div>
            </form>
        </div>
    </div>

{% endblock %}

{% block extra_js %}
{{ modelos_andamento_json|json_script:"modelos-andamento-data" }}
<script src="{% static 'js/detalhe_caso.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modelosDataEl = document.getElementById('modelos-andamento-data');
        const modelosData = modelosDataEl ? JSON.parse(modelosDataEl.textContent) : {};
        
        // Inicializa todas as funcionalidades da pﾃ｡gina
        initDetalheCaso({
            modelosAndamento: modelosData
        });

        // Exibe mensagens do Django usando a funﾃｧﾃ｣o de toast global
        {% if messages %}
            {% for message in messages %}
                // A tag 'success', 'error', 'info', 'warning' do Django ﾃｩ usada como tipo do toast
                showToast('{{ message|escapejs }}', '{{ message.tags }}');
            {% endfor %}
        {% endif %}
    });
</script>
{% endblock %}