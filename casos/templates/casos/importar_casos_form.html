{% extends "base.html" %}
{% load static %}

{% block title %}Importar Casos | Sistema Jurídico{% endblock %}

{% block content %}
<div class="container" style="max-width: 900px;">
    
    <!-- HERO HEADER -->
    <div class="hero-header">
        <div class="hero-content">
            <div class="hero-icon" style="background: var(--success);"><i class="fa-solid fa-file-import"></i></div>
            <div>
                <h1 class="hero-title" style="justify-content: flex-start;">Importação Massiva de Casos</h1>
                <p class="hero-subtitle text-muted">Importe múltiplos casos de uma vez usando planilha Excel</p>
            </div>
        </div>
    </div>

    <!-- MENSAGENS -->
    {% include 'casos/partials/app_messages.html' %}

    <!-- INFO BOX -->
    <div class="info-box" style="border-color: var(--success-solid);">
        <i class="fa-solid fa-circle-info info-box-icon" style="color: var(--success-solid);"></i>
        <div class="info-box-content">
            <p><strong>Como usar:</strong> Selecione o cliente e produto, depois faça upload da planilha Excel (.xlsx). A planilha deve seguir o modelo gerado pelo sistema.</p>
        </div>
    </div>

    <!-- FORM CARD -->
    <div class="card">
        <form method="post" action="{% url 'casos:importar_casos_view' %}" enctype="multipart/form-data" id="importForm">
            {% csrf_token %}
            
            <!-- SELEÇÃO DE CLIENTE E PRODUTO -->
            <div class="form-section">
                <h3 class="form-section-title"><i class="fa-solid fa-building" style="color: var(--success-solid);"></i> Configuração Básica</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cliente-select" class="required-label"><i class="fa-solid fa-building"></i> Cliente</label>
                        <select class="form-control is-valid" id="cliente-select" name="cliente" required><option value="" disabled selected>Selecione</option>{% for cliente in clientes %}<option value="{{ cliente.id }}">{{ cliente.nome }}</option>{% endfor %}</select>
                    </div>
                    <div class="form-group">
                        <label for="produto-select" class="required-label"><i class="fa-solid fa-box"></i> Produto</label>
                        <select class="form-control is-valid" id="produto-select" name="produto" required><option value="" disabled selected>Selecione</option>{% for produto in produtos %}<option value="{{ produto.id }}">{{ produto.nome }}</option>{% endfor %}</select>
                    </div>
                </div>
            </div>

            <!-- UPLOAD DE ARQUIVO -->
            <div class="form-section">
                <h3 class="form-section-title"><i class="fa-solid fa-cloud-arrow-up" style="color: var(--success-solid);"></i> Upload da Planilha</h3>
                <div id="uploadArea" class="upload-area">
                    <div class="upload-icon-wrapper"><i class="fa-solid fa-file-excel"></i></div>
                    <h3>Arraste o arquivo aqui</h3>
                    <p>ou clique para selecionar</p>
                    <label for="arquivo-excel" class="btn btn-outline-primary" style="border-color: var(--success-solid); color: var(--success-solid);"><i class="fa-solid fa-folder-open"></i> Escolher Arquivo</label>
                    <small>Formato aceito: .xlsx</small>
                    <input type="file" style="display: none;" id="arquivo-excel" name="arquivo_excel" accept=".xlsx" required>
                </div>

                <!-- Preview do arquivo -->
                <div id="filePreview" class="file-preview-box">
                    <div class="file-preview-icon"><i class="fa-solid fa-file-excel"></i></div>
                    <div class="file-preview-info">
                        <div id="fileName" class="name"></div>
                        <div id="fileSize" class="size"></div>
                    </div>
                    <button type="button" id="removeFile" class="btn btn-sm btn-danger" title="Remover arquivo"><i class="fa-solid fa-xmark"></i></button>
                </div>
            </div>

            <!-- SUBMIT -->
            <div class="form-actions" style="justify-content: flex-end;">
                <button type="submit" id="submitBtn" class="btn btn-success" disabled style="width: 100%; padding: 16px; font-size: 1.1rem;">
                    <i class="fa-solid fa-file-import"></i> <span>Iniciar Importação</span>
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/form_importar_casos.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        initImportForm({});
    });
</script>
{% endblock %}