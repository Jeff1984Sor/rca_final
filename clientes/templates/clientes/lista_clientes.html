{% extends 'base.html' %}
{% load static %}

{% block title %}Gestão de Clientes | Sistema Jurídico{% endblock %}

{% block content %}
<div class="container">
    
    <!-- HERO HEADER -->
    <div class="hero-header">
        <div class="hero-content">
            <h1 class="hero-title"><i class="fa-solid fa-building"></i> Gestão de Clientes</h1>
            <div class="hero-actions">
                <a href="{% url 'clientes:exportar_excel' %}?filtro_nome={{ filtro_nome }}&filtro_tipo={{ filtro_tipo }}" class="btn btn-export"><i class="fa-solid fa-file-excel"></i> Exportar Excel</a>
                <a href="{% url 'clientes:criar_cliente' %}" class="btn btn-primary"><i class="fa-solid fa-plus-circle"></i> Novo Cliente</a>
            </div>
        </div>
    </div>
    
    <!-- FILTROS -->
    <div class="card filtros-card">
        <div class="card-header filtros-header">
            <h5><i class="fa-solid fa-filter"></i> Filtros de Pesquisa</h5>
            {% if filtro_nome or filtro_tipo %}
                <span class="badge filter-active-badge"><i class="fa-solid fa-circle-check"></i> Filtros Ativos</span>
            {% endif %}
        </div>
        <div class="card-body">
            <form method="GET" action="{% url 'clientes:lista_clientes' %}">
                <div class="form-row" style="align-items: end;">
                    <div class="form-group">
                        <label for="id_filtro_nome"><i class="fa-solid fa-user"></i> Nome do Cliente</label>
                        <input id="id_filtro_nome" type="text" name="filtro_nome" class="form-control" placeholder="Digite parte do nome..." value="{{ filtro_nome }}">
                    </div>
                    <div class="form-group">
                        <label for="id_filtro_tipo"><i class="fa-solid fa-id-card"></i> Tipo de Pessoa</label>
                        <select id="id_filtro_tipo" name="filtro_tipo" class="form-control">
                            <option value="">Todos os Tipos</option>
                            <option value="PF" {% if filtro_tipo == 'PF' %}selected{% endif %}>Pessoa Física</option>
                            <option value="PJ" {% if filtro_tipo == 'PJ' %}selected{% endif %}>Pessoa Jurídica</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <div class="d-flex gap-12">
                            <button type="submit" class="btn btn-filter"><i class="fa-solid fa-magnifying-glass"></i> Filtrar</button>
                            <a href="{% url 'clientes:lista_clientes' %}" class="btn btn-clear"><i class="fa-solid fa-eraser"></i> Limpar</a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <!-- TABELA -->
    <div class="data-table-container mt-4">
        <table class="data-table">
            <thead>
                <tr>
                    <th><i class="fa-solid fa-user"></i> Nome</th>
                    <th><i class="fa-solid fa-id-card"></i> Tipo</th>
                    <th><i class="fa-solid fa-map-marker-alt"></i> Cidade/UF</th>
                    <th><i class="fa-solid fa-phone"></i> Contato</th>
                    <th class="text-right"><i class="fa-solid fa-gear"></i> Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for cliente in clientes %}
                <tr>
                    <td><strong>{{ cliente.nome }}</strong></td>
                    <td>
                        <span class="badge {% if cliente.tipo == 'PF' %}pf{% else %}pj{% endif %}">
                            <i class="fa-solid fa-{% if cliente.tipo == 'PF' %}user{% else %}building{% endif %}"></i>
                            {{ cliente.get_tipo_display }}
                        </span>
                    </td>
                    <td>{{ cliente.cidade|default:"-" }}/{{ cliente.uf|default:"-" }}</td>
                    <td>{{ cliente.contato_empresa|default:"-" }}</td>
                    <td class="actions text-right">
                        <a href="{% url 'clientes:editar_cliente' pk=cliente.pk %}" class="btn action-btn btn-edit" title="Editar cliente"><i class="fa-solid fa-pen-to-square"></i></a>
                        <a href="{% url 'clientes:deletar_cliente' pk=cliente.pk %}" class="btn action-btn btn-delete" title="Deletar cliente" onclick="return confirm('⚠️ Tem certeza que deseja deletar este cliente?');"><i class="fa-solid fa-trash-alt"></i></a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">
                        <div class="empty-state">
                            <i class="fa-solid fa-building-slash"></i>
                            <h3>Nenhum cliente encontrado</h3>
                            <p>Tente ajustar os filtros ou crie um novo cliente.</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/lista_clientes.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        initListaClientes({
            createUrl: "{% url 'clientes:criar_cliente' %}",
            listUrl: "{% url 'clientes:lista_clientes' %}"
        });
    });
</script>
{% endblock %}